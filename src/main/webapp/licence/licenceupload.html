<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<METAHTTP-EQUIV="Pragma"CONTENT="no-cache">
<METAHTTP-EQUIV="Cache-Control"CONTENT="no-cache">
<METAHTTP-EQUIV="Expires"CONTENT="0">
<link rel="stylesheet" href="../js/bootstrap/css/bootstrap.min.css" >
<link href="../css/fileinput.css" media="all" rel="stylesheet" type="text/css" />
<link href="../js/bootstrapdatetimepicker/css/bootstrap-datetimepicker.css" rel="stylesheet" media="screen">
<style type="text/css">
.col-center-block {  
    float: none;  
    display: block;  
    margin-left: auto;  
    margin-right: auto;  
}  
</style>
</head>
<body>
<div class="col-xs-6 col-md-4 col-center-block" > 
<div id="myAlert" class="alert alert-warning" style="display: none;">
	<a href="#" class="close" data-dismiss="alert">&times;</a>
	</div>
 <form id="registerForm" role = "form"> 
	    <div class = "form-group"> 
		     <label for = "licenceName">证照名称：</label> 
		     <input type = "text" class = "form-control" id = "licencename" name="licenceName" placeholder = "请输入证照名称"></input> 
	    </div> 
	    <div class="form-group">
        			<label class="control-label">成立日期 ：</label>        
           		<div class='input-group date' id='datetimepicker1'>            
	               	 <input type='text' class="form-control"  name="start_date" id="startDate">        
	                  <span class="input-group-addon">            
	                    <span class="glyphicon glyphicon-calendar"></span>        
	                  </span>        
           		</div>
         	</div>
           <div class="form-group">
                	 <label class="control-label">截止日期：</label>
                	 <div class='input-group date' id='datetimepicker2'>            
	                	   <input type='text' class="form-control" name="end_date"  id="endDate"/>                
	                    <span class="input-group-addon">                    
	                        <span class="glyphicon glyphicon-calendar"></span>                
	                    </span>        
      			</div>            
           </div>
	     <div class="form-group">
       		<input id="file_upload" type="file"  multiple class="file" data-overwrite-initial="false" data-min-file-count="1">
       		<input type="hidden" id="ftpURL">
       		<input type="hidden" id="fileName">
		</div>
	    <div class="form-group"  style="text-align:center;"> 
	     	<!-- 提供额外的视觉效果，标识一组按钮中的原始动作 --> 
  			 <button type="button" id="sublicence" class="btn btn-primary">提交</button>
	    </div> 
   </form>
  </div> 
<script src="../js/jquery/js/jquery-3.2.1.min.js"></script>
<script src="../js/jquery/js/jquery-rest.js"></script>
<script src="../js/xjl/js/fileinput.js" type="text/javascript"></script>
<script src="../js/bootstrap/js/bootstrap.min.js"></script>
<script src="../js/bootstrapdatetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script type="text/javascript" src="../js/bootstrapdatetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>
<script  type="text/javascript"  src="../js/xjl/js/custom.js"></script>
</body>
 <script type="text/javascript">
 /* 上传文件*/
 $("#file_upload").fileinput({
        uploadUrl: '../rest/licence/upload',  
        overwriteInitial: false
  });
 /*上传回调方法*/
 $("#file_upload").on("fileuploaded", function (event, data, previewId, index) {
	  if(data.response){
		  $("#fileName").val(data.response.fileName);
		  $("#ftpURL").val(data.response.ftpURL);
	  }
   });
     $(function(){
    		 /*时间控件*/
    		$('#datetimepicker1').datetimepicker({
    			minView: "month",
    			format: 'yyyy-mm-dd',
 			language: 'zh-CN',
 		    autoclose:true
    		});
    	 	$("#datetimepicker2").datetimepicker({
    	 		minView: "month",
    	 		format:'yyyy-mm-dd',
    	 		language: 'zh-CN',
    	        autoclose:true
    	 	});
    	 	/*控制时间插件*/
    	 	$("#datetimepicker1").on("changeDate", function (ev) {
    	 		$('#datetimepicker2').datetimepicker('setStartDate', ev.date);
	     });        
	     $("#datetimepicker2").on("changeDate", function (ev) {
	    		 $("#datetimepicker1").datetimepicker("setEndDate",ev.date);
	     }); 
	     /*提交*/
	     $("#sublicence").click(function(){
    	   var startDate = $("#startDate").val();
    	   var endDate = $("#endDate").val();
    	   var fileName =  $("#fileName").val();
    	   if(startDate.length == 0){
			  $("#myAlert").attr("class","alert alert-warning");
			  showMsg("提示","请输入成立日期");
			  return;
    	   }
    	   if(endDate.length == 0){
			   $("#myAlert").attr("class","alert alert-warning");
			   showMsg("提示","请输入截止日期");
			   return;
    	   }
    	   if(fileName.length == 0){
			   $("#myAlert").attr("class","alert alert-warning");
			   showMsg("提示","请先上传文件");
			   return;
    	   }
    	 	var data={"licencename":$("#licencename").val(),"startDate":startDate,"endDate":endDate,"ftpURL":$("#ftpURL").val(),"fileName":fileName};
    		$.restPost({
    			 url:'../rest/licence/add',
    			 data:data,
    			 success:function(data){
    				if(data.success){
  					  	$("#myAlert").attr("class","alert alert-success");
  					 	showMsg("提示","上传成功");
    				}
    			 }
    		}); 
	     });
     })
 </script>
</html>